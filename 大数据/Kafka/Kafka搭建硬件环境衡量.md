[toc]



## 线上集群部署

线上集群部署方案，考虑点： **操作系统、磁盘容量、硬盘、带宽**



#### 操作系统

操作系统，多考虑底层支持的IO模型：阻塞式IO、非阻塞式IO、I/O多路复用、信号驱动I/O和异步I/O。

| 系统/应用      | 支持I/O模型                                                  |
| -------------- | ------------------------------------------------------------ |
| Linux          | select函数支持I/O多路复用  epoll（趋于I/O多路复用和信号驱动I/O之间） |
| Java IO        | java IO支持阻塞式IO                                          |
| Java NIO       | 非阻塞式IO 支持Linux select函数和epoll                       |
| Windows        | 支持异步IO，IOCP线程支持                                     |
| Java NIO2  AIO | 支持异步IO                                                   |

Java  selector 在Linux 对应 epoll，Windows 上对应 select/poll

AIO 

##### Zero Copy

生产者和消费者差距过大会丢失Zero Copy特性，Zero Copy 利用了mmap减少了内核态到用户态的转换，直接将Page Cache 内容利用Socket发送给网卡。

#### 磁盘容量

磁盘容量，需要预留磁盘容量，一般情况下，操作系统在剩余10%情况下容易出现异常；

kafka使用需要对索引文件，日志等正常使用，所以建议预留20%。

#### 磁盘

Kafka 在软件应用层支持了数据冗余备份，可以直接在磁盘上构建Kafka消息系统；但是在磁盘出现问题时，reblance会花费更多的时间，一般不建议这样做。

使用raid10或raid5等技术，可以尽可能避免reblance花费的时间。但是消息效率理论比磁盘构建慢。

#### 带宽

带宽计算考虑到实际网络稳定性和协议头大小，一般情况下以带宽70%计算。

同时要考虑Kafka消息备份和其他应用网络开销，一般情况下，以实际带宽的1/3计算。

